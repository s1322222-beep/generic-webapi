<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>AI Fortune Canvas</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
<style>
body{margin:0;background:#111;color:#fff;font-family:system-ui}
header{padding:10px;display:flex;gap:8px}
input,button{padding:10px;font-size:16px}
</style>
</head>
<body>
<header>
  <input id="msg" placeholder="ä¸€è¨€ï¼ˆæ‹ãƒ»ãƒã‚¤ãƒˆãƒ»ãƒ†ã‚¹ãƒˆï¼‰">
  <button onclick="send()">å ã†</button>
</header>
<div id="fortune">ğŸ”®</div>

<script>
let data = { fortune:"", luck:0.5, color:"#4DA3FF", shape:"circle" };
const colors = ["#FF7A00","#4DA3FF","#B84DFF","#00E5A8","#FF4D6D","#FFD166","#06D6A0","#118AB2"];
const shapes = ["circle","square","wave"];

function send(){
  const text = document.getElementById("msg").value;

  fetch("/api/",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ prompt:text })
  })
  .then(r=>r.json())
  .then(j=>{
    const obj = j.data || j;

    data.fortune = obj.fortune || "ä»Šæ—¥ã¯ç©ã‚„ã‹ãªæ—¥";
    data.luck = Math.random();          // â† å¿…ãšå¤‰ã‚ã‚‹
    data.color = colors[Math.floor(Math.random()*colors.length)];
    data.shape = shapes[Math.floor(Math.random()*shapes.length)];

    document.getElementById("fortune").innerText =
      "ğŸ”® " + data.fortune + " (" + Math.round(data.luck*100) + "%)";
  });
}

function setup(){ createCanvas(window.innerWidth,400); }
function draw(){
  background(10);
  fill(data.color);
  noStroke();
  const s = 100 + data.luck*200;

  if(data.shape==="square"){
    rect(width/2-s/2,height/2-s/2,s,s);
  }else if(data.shape==="wave"){
    noFill();
    stroke(data.color);
    for(let x=0;x<width;x+=10){
      point(x,height/2 + Math.sin(x/20+frameCount/10)*50);
    }
  }else{
    ellipse(width/2,height/2,s,s);
  }
}
</script>
</body>
</html>
